



<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="utf-8">
    <title>GDB - Breakpoint na funkcji w anonimowej przestrzeni nazw C++ | chyla.org</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="../../_static/IBM-Plex-Web-5.2.1/css/ibm-plex-mod.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-icons-1.4.0/bootstrap-icons.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootswatch-cosmo-4-mod.css" type="text/css" />

	
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/chyla.css" />
    <link rel="shortcut icon" href="../../_static/logo-45x45.png"/>
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/pdfobject/pdfobject.min.js"></script>
    <script src="../../_static/translations.js"></script> 
  </head>

  <body>
    <nav class="navbar navbar-expand-md fixed-top chyla-navbar-light">
        <div class="navbar-brand-logo">
            <a class="navbar-brand" href="../../index.html">
                <img src="../../_static/logo-45x45.png" alt="Logo" id="logo" width="45px" height="45px">
            </a>
        </div>

        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="../../index.html">Cześć!</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../index.html">Artykuły</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../../edukacja/index.html">Edukacja</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../../repozytorium-pakietow/index.html">Repozytorium</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../../eduvm/index.html">EduVM</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../../oprogramowanie/omtt.html">OMTT</a>
            </li>
          </ul>
        </div>

        <div class="navbar-nav navbar-right">
            <div id="searchbox" role="search">
                <div class="searchformwrapper">
                    <form class="search-form" action="../../search.html" method="get">
                        <div class="input-group">
                            <input id="navbar-search-input" class="form-control" type="text" name="q" placeholder="Szukamy?" aria-label="Search input field">
                            <div class="input-group-append">
                            <button type="submit" class="input-group-text"><i class="bi bi-search"></i></button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <button class="navbar-toggler chyla-navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
             <i class="bi bi-list"></i>
        </button>
</nav>

<div id="navbar-placeholder"></div>
<main>
    <div class="document">
        <div class="container">
            <div class="body" role="main">
                
  <section id="gdb-breakpoint-na-funkcji-w-anonimowej-przestrzeni-nazw-c">
<h1>GDB - Breakpoint na funkcji w anonimowej przestrzeni nazw C++<a class="headerlink" href="#gdb-breakpoint-na-funkcji-w-anonimowej-przestrzeni-nazw-c" title="Stały odnośnik do tego nagłówka">¶</a></h1>
<p>Wykorzystując instrukcję <code class="docutils literal notranslate"><span class="pre">break</span></code> możemy ustawić pułapkę na daną funkcję. Na ogół nie sprawia trudności ustawienie jej na funkcję globalną, metodę klasy, czy funkcję w nazwanej przestrzeni nazw (za pomocą <code class="docutils literal notranslate"><span class="pre">::</span></code>).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span><span class="w"></span>

<span class="k">namespace</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">funkcja</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">funkcja</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>W przypadku anonimowej przestrzeni nazw przed <code class="docutils literal notranslate"><span class="pre">::</span></code> zamiast nazwy przestrzeni, czy klasy powinniśmy dopisać <code class="docutils literal notranslate"><span class="pre">(anonymous</span> <span class="pre">namespace)</span></code>, jak w poniższym przykładzie:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; gdb ./a.out
GNU gdb (GDB) Fedora 7.12.1-41.fc25
Copyright (C) 2017 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;x86_64-redhat-linux-gnu&quot;.
Type &quot;show configuration&quot; for configuration details.
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
&lt;http://www.gnu.org/software/gdb/documentation/&gt;.
For help, type &quot;help&quot;.
Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...
Reading symbols from ./a.out...done.
(gdb) b funkcja
Function &quot;funkcja&quot; not defined.
Make breakpoint pending on future shared library load? (y or [n]) n
(gdb) break (anonymous namespace)::funkcja
Breakpoint 1 at 0x4007aa: file anonymous-namespace.cpp, line 8.
(gdb) quit
</pre></div>
</div>
<p>Jest to oczywiście jedno rozwiązanie. Inną metodą jest znalezienie nazwy funkcji w stylu C (udekorowanej - <a class="reference external" href="https://en.wikipedia.org/wiki/Name_mangling">name mangling</a>) i na niej ustawienie pułapki. Nazwę funkcji możemy poznać za pomocą polecenia <code class="docutils literal notranslate"><span class="pre">nm</span></code> (linia 39) lub <code class="docutils literal notranslate"><span class="pre">objdump</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; nm a.out
0000000000601044 B __bss_start
0000000000601170 b completed.6917
                 U __cxa_atexit@@GLIBC_2.2.5
0000000000601040 D __data_start
0000000000601040 W data_start
00000000004006e0 t deregister_tm_clones
0000000000400760 t __do_global_dtors_aux
0000000000600de0 t __do_global_dtors_aux_fini_array_entry
00000000004008c8 R __dso_handle
0000000000600df0 d _DYNAMIC
0000000000601044 D _edata
0000000000601178 B _end
00000000004008b4 T _fini
0000000000400780 t frame_dummy
0000000000600dd0 t __frame_dummy_init_array_entry
0000000000400a70 r __FRAME_END__
0000000000601000 d _GLOBAL_OFFSET_TABLE_
0000000000400823 t _GLOBAL__sub_I_main
                 w __gmon_start__
00000000004008d4 r __GNU_EH_FRAME_HDR
0000000000400638 T _init
0000000000600de0 t __init_array_end
0000000000600dd0 t __init_array_start
00000000004008c0 R _IO_stdin_used
                 w _ITM_deregisterTMCloneTable
                 w _ITM_registerTMCloneTable
0000000000600de8 d __JCR_END__
0000000000600de8 d __JCR_LIST__
                 w _Jv_RegisterClasses
00000000004008b0 T __libc_csu_fini
0000000000400840 T __libc_csu_init
                 U __libc_start_main@@GLIBC_2.2.5
00000000004007b1 T main
0000000000400720 t register_tm_clones
00000000004006b0 T _start
0000000000601048 D __TMC_END__
00000000004007e5 t _Z41__static_initialization_and_destruction_0ii
00000000004007a6 t _ZN12_GLOBAL__N_17funkcjaEv
                 U _ZNSolsEi@@GLIBCXX_3.4
                 U _ZNSt8ios_base4InitC1Ev@@GLIBCXX_3.4
                 U _ZNSt8ios_base4InitD1Ev@@GLIBCXX_3.4
0000000000601060 B _ZSt4cout@@GLIBCXX_3.4
00000000004008d0 r _ZStL19piecewise_construct
0000000000601171 b _ZStL8__ioinit
                 U _ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_c@@GLIBCXX_3.4
</pre></div>
</div>
<p>Powyżej widać, że szukaną nazwą jest <code class="docutils literal notranslate"><span class="pre">_ZN12_GLOBAL__N_17funkcjaEv</span></code>. W przykładzie poniżej możemy zaobserwować, że pułapka została ustawiona (linia 18), a GDB poprawnie zinterpretowało jej nazwę (linia 23):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; gdb ./a.out
GNU gdb (GDB) Fedora 7.12.1-41.fc25
Copyright (C) 2017 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;x86_64-redhat-linux-gnu&quot;.
Type &quot;show configuration&quot; for configuration details.
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
&lt;http://www.gnu.org/software/gdb/documentation/&gt;.
For help, type &quot;help&quot;.
Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...
Reading symbols from ./a.out...done.
(gdb) b _ZN12_GLOBAL__N_17funkcjaEv
Breakpoint 1 at 0x4007aa: file anonymous-namespace.cpp, line 8.
(gdb) run
Starting program: /home/achyla/.adam/tests/a.out
Missing separate debuginfos, use: dnf debuginfo-install glibc-2.24-4.fc25.x86_64

Breakpoint 1, (anonymous namespace)::funkcja () at anonymous-namespace.cpp:8
8           return 5;
Missing separate debuginfos, use: dnf debuginfo-install libgcc-6.3.1-1.fc25.x86_64 libstdc++-6.3.1-1.fc25.x86_64
(gdb) c
Continuing.
5
[Inferior 1 (process 7443) exited normally]
(gdb) quit
</pre></div>
</div>
<section id="literatura">
<h2>Literatura<a class="headerlink" href="#literatura" title="Stały odnośnik do tego nagłówka">¶</a></h2>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://sourceware.org/bugzilla/show_bug.cgi?id=16874">Bug 16874 - Setting a breakpoint on function in anonymous namespace is unnecessarily awkward</a></p></li>
<li><p><a class="reference external" href="http://stackoverflow.com/questions/41524956/gcc-c-name-mangling-reference">Stack Overflow - GCC C++ Name mangling reference</a></p></li>
</ol>
</section>
</section>


                <div class="clearer"></div>
            </div>
        </div>
    </div>
</main>


    <footer id="footer" class="chyla-footer-light">
        <div class="row">
            <div class="footer-box footer-infos col-md-10">
				
<h5>Adam Chyła</h5>
<p>Specjalista ds. Rozwoju Oprogramowania</p>

            </div>
            <div class="footer-box chyla-footer-social-list col-md-2">
                <h5>Social media</h5>
                <ul>
					
<li><a href="https://github.com/chyla" target="_blank"><i class="bi bi-github"></i></a></li>

				</ul>
            </div>
        </div>

        <div class="row">
            <div class="footer-box footer-law col-md-12">
				
<p>Witryna prywatna. Każda opinia wyrażona w tej wirtynie jest wyłącznie moją opinią (nie jest to opinia mojego pracodawcy).<br/>
   Private website. All opinions expressed here are only mine (not of my employer).</p>

<p><a href="/law/nota_prawna.html">Zapoznaj się z notą prawną dotyczącą treści i funkcjonowania portalu</a> oraz <a href="/law/polityka_prywatnosci_i_plikow_cookies.html">polityką prywatności i plików cookie</a>.</p>

            </div>
        </div>
    </footer>

    <script src="../../_static/bootstrap-4.6/bootstrap.bundle.min.js"></script>
	
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DKEWN50PZG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DKEWN50PZG');
</script>


  </body>
</html>